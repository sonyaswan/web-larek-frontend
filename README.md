# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание

Интернет-магазин "Web-ларёк" содержит каталог товаров для веб-разработчиков, c возможностью покупки товаров через корзину и оформления заказа. Главная страница отображает каталог товаров и иконку корзинки со счетчиком товаров в ней, при нажатии на карточку товара будет открываться модальное окно с детальной информацией о товаре, а при нажатии на иконку корзины будет открываться корзина. Просмотр товара будет показывать детальную информацию о товаре, при нажатии на кнопку "Купить" товар будет добавляться в корзину, а при нажатии на кнопку "Убрать" товар будет удаляться из корзины. Оформление товара будет включать выбор способа оплаты, ввод адреса доставки и ввод почты и телефона покупателя.

## Архитектура 

В приложении используется MVP-архитектура.
Приложение взаимодействует с пользователем через события. Модели инициируют события, обработчики событий в основном коде передают данные компонентам отображения и выполняют вычисления между этой передачей и изменяют значения в моделях.
 
![web-larek.UML.png](https://github.com/sonyaswan/web-larek-frontend/blob/main/web-larek.UML.png)


### Базовые классы


#### Класс `Api`

Класс Api предоставляет функционал для работы с API, включая выполнение различных типов запросов и обработку ответов.

Поля:
* `baseUrl`: `string` - представляет базовый URL API.
* `options`: `RequestInit` - представляет настройки запроса.

Методы:
* `_handleResponse`- обрабатывает ответ от API. Если ответ успешный, он возвращает JSON-объект. Если ответ неуспешный, он возвращает ошибку.
* `_request` - универсальный метод, выполняет запрос к API и обрабатывает ответ
* `get`- выполняет GET-запрос к API.
* `post` - выполняет POST-, PUT- или DELETE-запрос к API.


#### Класс `EventEmitter`

Базовый класс, реализующий функции брокера событий (паттерн `Наблюдатель`).
Класс `EventEmitter` реализует интерфейс `IEvents` и имеет поле `_events`, которое является картой, содержащей события и их подписчиков (хранит информацию о том, какие функции подписаны на какие события)

Методы:
* `on` устанавливает обработчик на событие
* `off` снимает обработчик с события
* `emit` инициирует событие с данными
* `onAll` слушает все события
* `offAll` сбрасывает все обработчики
* `trigger` создает коллбек триггер, генерирующий событие при вызове.


#### Класс `Model<T>`

Абстрактный класс `Model<T>` является базовой моделью, которая отличается от простых объектов с данными. Он имеет поля `data` и `events`. Свойство `data` содержит данные модели, а `events` - объект событий. Метод `emitChanges`, используется для информирования всех подписчиков о том, что модель изменилась и вызывает метод `emit` объекта `events`, передавая ему событие и, возможно, объект данных. 


Этот класс служит базовой моделью и может быть использован для отличия простых объектов с данными от объектов, которые наследуются от `Model<T>`. 


#### Класс `Component<T>`

Абстрактный класс `Component<T>` является базовым классом, который предоставляет функционал для работы с DOM в дочерних компонентах. Он имеет поля `container` и `data`, которые используются для хранения корневого DOM-элемента и данных компонента соответственно.

Конструктор класса Component<T> принимает один параметр - DOM-элемент, в который будет помещен компонент.
`constructor(container: HTMLElement)`

Методы `toggleClass`, `setText`, `setDisabled`, `setHidden`, `setVisible`, `setImage` и `render` предоставляют инструменты для работы с DOM-элементами. Метод `toggleClass` позволяет переключать класс элемента, `setText` устанавливает текстовое содержимое элемента, `setDisabled` устанавливает состояние блокировки элемента, `setHidden` скрывает элемент, `setVisible` показывает элемент, `setImage` устанавливает изображение с альтернативным текстом, а `render` возвращает корневой DOM-элемент.


### Слой данных (Model)


#### Класс `ProductModel`

Класс `ProductModel` расширяет класс `Model<T>` и реализует интерфейс `IProductItem`.
Предоставляет функционал для работы с моделью продукта (товара), включая установку и получение идентификатора, описания, изображения, заголовка, категории и цены продукта.

Поля:
* `id` - уникальный идентификатор продукта
* `description` - описание продукта
* `image` - путь к изображению продукта
* `title` - название продукта
* `category` - категория продукта, является значением из перечисления ProductStatus
* `price` - цена продукта, которая может быть числом или null, если продукт не имеет цены


#### Класс `AppState`

Класс `AppState` расширяет класс `Model<T>` и реализует интерфейс `IAppState`. 
Класс `AppState` предоставляет функционал для управления приложением и его элементами: каталогом продуктов, корзиной, превью и заказом пользователя.

Поля:
* `catalog` - содержит список продуктов из каталога
* `basket` - представляет корзину пользователя, содержащую сет из идентификаторов продуктов
* `preview` - содержит идентификатор продукта, который в данный момент отображается в режиме превью
* `order` -  представляет заказ пользователя, который может быть пустым, если заказ еще не был создан
* `loading` -  указывает, происходит ли в данный момент загрузка

Методы:
* `clearBasket` - очищает корзину пользователя
* `clearOrder` - очищает корзину пользователя
* `addToBasket` -  добавляет продукт в корзину пользователя
* `removeFromBasket` - удаляет продукт из корзины пользователя
* `getStatusBasket` - возвращает количество продуктов в корзине пользователя
* `getProductsFromBasket` - возвращает список продуктов из корзины пользователя с описанием
* `getTotal` - вычисляет общую стоимость заказа пользователя
* `setCatalog` - заполняет данные каталога продуктов
* `setPreview` - заполняет данные превью продукта пользователя
* `setOrderField` - заполняет данные заказа пользователя
* `validateOrder` - проверяет поля заказа пользователя


### Слой отображения (View)


#### Интерфейс `ICard`

Интерфейс `ICard` определяет свойства карточки продукта, которые используются в классах `Card`, `CatalogCard`, `PreviewCard` и `BasketCard`. Он содержит следующие свойства:

* `id`: Тип `string` - представляет идентификатор продукта.
* `title`: Тип `string` - представляет название продукта.
* `price`: Тип `number | null` -  представляет цену продукта.
* `image`: Тип `string` - представляет URL-адрес изображения продукта.
* `category`: Тип `ProductStatus` - представляет категорию продукта.


#### Класс `Card`

Класс `Card` является расширением класса `Component` и реализует интерфейс `ICard`. 
Предоставляет функционал для работы с элементами интерфейса карточки товара.
Класс `Card` является базовым классом для всех остальных классов карточек и содержит общие методы и свойства для работы с элементами интерфейса.

Поля:
* `_title` -  представляет заголовок карточки продукта.
* `_price` - представляет цену карточки продукта.
* `_image` - представляет изображение карточки продукта.
* `_category` - представляет категорию карточки продукта.
* `_description` - представляет описание карточки продукта.
* `_categoryColor` - представляет цвета категорий карточки продукта.

Методы:
* `set id` - устанавливает идентификатор карточки продукта.
* `get id` - возвращает идентификатор карточки продукта.
* `set title` - устанавливает заголовок в карточке продукта.
* `set price` - устанавливает цену в карточке продукта.
* `set image` - устанавливает изображение в карточке продукта.
* `set category` - устанавливает категорию в карточке продукта.

#### Класс `CatalogCard`

Класс `CatalogCard` расширяет класс `Card` и добавляет обработчик событий `onClick`, который может быть передан в конструктор.
Предоставляет функционал для работы с карточкой товара в каталоге.


#### Класс `PreviewCard`

Класс `PreviewCard` также расширяет класс `Card` и добавляет обработчик событий `onClick` для кнопки.
Предоставляет функционал для работы с карточкой товара в модальном окне превью.

Методы:
* `set description` - устанавливает описание в карточке продукта.
* `set selected` - устанавливает состояние кнопки "купить" в зависимости от наличия продукта в корзине


#### Класс `BasketCard`

Класс `BasketCard` также расширяет класс `Card` и добавляет обработчик событий `onClick` для кнопки удаления элемента из корзины, а также свойство `index`, которое позволяет устанавливать и получать индекс элемента в корзине.
Предоставляет функционал для работы с карточкой товара в корзине.


#### Класс `Basket`
Класс `Basket` является расширением класса `Component` и реализует интерфейс `IBasketView`
Предоставляет функционал для работы с корзиной в открывающемся модальном окне.

Поля:
* `_list` - представляет список товаров в корзине.
* `_total` - представляет общую сумму заказа.
* `_button` - представляет кнопку оформления заказа.

Методы:
* `set items` - устанавливает элементы (продуктов) корзины.
* `set selected` - устанавливает состояние кнопки заказа в зависимости от состояния корзины.
* `set total` - устанавливает общую сумму заказа.


#### Класс `Modal`

Класс `Modal` является расширением класса `Component` и реализует интерфейс `IModalData`. 
Предоставляет функционал для работы с модальными окнами, включая установку содержимого, открытие и закрытие окна, а также обработку событий.

Поля:
* `content` - представляет содержимое модального окна.
* `closeButton` представляет кнопку закрытия модального окна.
* `container` - представляет корневой DOM-элемент модального окна.
* `events` - представляет объект событий модального окна.

Методы:
* `open` - открывает модальное окно.
* `close` - закрывает модальное окно.
* `set content` - устанавливает содержимое модального окна.
* `render` - возвращает корневой DOM-элемент и открывает модальное окно.


#### Класс `Form`

Класс `Form` является расширением класса `Component` и реализует интерфейс `IFormState`. 
Предоставляет функционал для работы с формами, включая обработку изменений полей, установку состояния формы и обработку событий.

Поля:
* `valid` - определяет, является ли форма валидной.
* `errors` - представляет список ошибок формы.

Методы:
* `onInputChange` - обрабатывает изменение значения поля формы.
* `render` - возвращает корневой DOM-элемент формы и устанавливает его состояние.


#### Класс `OrderAdress`

Класс `OrderAdress` является расширением класса `Form`.
Предоставляет функционал для работы с первой формой заказа, в которой выбирается тип оплаты и адрес доставки.

Поля:
* `_paymentButtons` - представляет массив кнопок выбора способа оплаты
* `_adressInput` - поле ввода адреса

Методы:
* `payment` - устанавливает выбранный способ оплаты.
* `address` -  устанавливает адрес доставки.


#### Класс `OrderContact`

Класс `OrderContact` является расширением класса `Form`.
Предоставляет функционал для работы со второй формой заказа с контактными данными.

Поля:
* `_phoneInput` - поле ввода телефона
* `_emailInput` - поле ввода электронной почты

Методы:
* `phone` - устанавливает номер телефона.
* `email` - устанавливает адрес электронной почты.


#### Класс `Success` 

Класс `Success` является расширением класса `Component`.
Предоставляет функционал для работы с успешным завершением заказа, включая установку и отображение общей суммы заказа.

Поля:
* `_total` - представляет элемент, который отображает общую сумму заказа.
* `_close` - представляет кнопку закрытия.

Методы:
* `set total` - устанавливает общую сумму заказа.


#### Класс `Page`

Класс `Page` является расширением класса `Component` и реализует интерфейс `IPage`. 
Предоставляет функционал для работы со страницей, включая установку счетчика товаров в корзине, элементов каталога и состояния блокировки страницы.

Поля:
* `counter` - счетчик товаров в корзине.
* `catalog` - массив элементов каталога.
* `locked` - определяет, заблокирована ли страница.

Методы:
* `set counter` - устанавливает значение счетчика товаров в корзине.
* `set catalog` - устанавливает элементы каталога.
* `set locked` - устанавливает, заблокирована ли страница.


### Описание событий:

- `items:changed` - вывод каталога с продуктами на страницу
- `card:select` - установить открываемую карточку товара
- `preview:open` - открытие модального окна с выбранной карточкой
- `product:buy` - добавление продукта в корзину
- `basket:open` - открытие корзины
- `product:delete` - удаление продукта из корзины
- `order:start` - начало заполнения заказа. открыть форму заказа - 1-й шаг: форма оплаты и адрес
- `payment:change` - изменение типа оплаты
- `/^order\..*:change/` - изменение полей формы первого шага заказа (в данном случае только адрес) и установка этих значений
- `order:submit` - продолжение заполнения заказа. открыть форму заказа - 2-й шаг: контактная информация
- `/^contacts\..*:change/` - изменение полей формы второго шага заказа (почта и телефон) и установка этих значений
- `order:ready` - заполнены все данные заказа успешно
- `formErrors:change` - изменение состояния валидации форм
- `contacts:submit`- контакты заполнены, отправка данныъ заказа на сервер и открытие модального окна успешного заказа
- `success:close` - закрытие окна успешного заказа по кнопке


### Работа с API


#### Класс `WebLarekAPI`

Класс `WebLarekAPI` является расширением класса `Api` и имеет дополнительное поле `cdn`. Конструктор класса `WebLarekAPI` принимает `cdn` и `baseUrl` в качестве аргументов и вызывает конструктор родительского класса `Api`. Предоставляет функционал для работы с конкретным API приложения.

Методы:
* `getProductList` использует метод `get` класса `Api` для получения списка товаров и возвращает промис с массивом товаров. 
* `getProductItem` также использует метод `get` для получения информации о товаре по его `id` и возвращает промис с объектом товара. 
* `orderProducts` использует метод `post` для размещения заказа и возвращает промис с результатом заказа.

Класс `WebLarekAPI` также использует типы и интерфейсы `ProductStatus`, `productId`, `IProductItem`, `IOrderForm`, `IOrder` и `IOrderResult`.


### Использованные классы и интерфейсы в проекте

Описанные типы и интерфейсы предоставляют структуру данных для работы с информацией о продуктах, заказах, карточками товаров и состоянием приложения.
```
//Тип, представляющий статус продукта.
type ProductStatus = 'софт-скил' | 'хард-скил' | 'кнопка' | 'другое' | 'дополнительное';

//Тип, представляющий идентификатор продукта.
type productId = string;

//Интерфейс, представляющий информацию о продукте.
interface IProductItem {
  id: productId;
  description: string;
  image: string;
  title: string;
  category: ProductStatus;
  price: number | null
};


//Интерфейс, представляющий информацию способе оплаты и адресе доставке
interface IOrderAdress {
  payment: string;
  address: string
};

//Интерфейс, представляющий информацию о контактной информации покупателя.
interface IOrderContact {
  email: string;
  phone: string
};

//Интерфейс, представляющий  полную контаную информацию и способ оплаты. Объединяет интерфейсы IOrderAdress и IOrderContact
type IOrderForm = IOrderAdress & IOrderContact;

//Интерфейс, представляющий информацию полную информацию о заказе, контактнах, составе заказа
interface IOrder extends IOrderForm {
  items: productId[];
  total: number
};

//Тип, представляющий ошибки формы.
type FormErrors = Partial<Record<keyof IOrder, string>>;

Интерфейс, представляющий результат заказа.
interface IOrderResult {
  id: string;
  total: number
};

Интерфейс, представляющий состояние приложения.
interface IAppState {
  catalog: IProductItem[];
  basket: productId[];
  preview: productId | null;
  order: IOrder | null;
  loading: boolean;
};

//Интерфейс, представляющий информацию о карточке товара. 
interface ICard {
  id: string;
  title: string;
  price: number | null
  image?: string;
  category?: ProductStatus;
  description?: string;
  index?: number
}

//Интерфейс, представляющий информацию о странице.
interface IPage {
  counter: number;
  catalog: HTMLElement[];
  locked: boolean;
}

//Интерфейс, представляющий информацию о корзине.
interface IBasketView {
    items: HTMLElement[];
    total: number;
    selected: string[];
}
```
